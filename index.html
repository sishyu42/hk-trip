<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>È¶ôÊ∏ØËÅñË™ï | ÂäüËÉΩÂÖ®ÈñãÁâà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Mountains+of+Christmas:wght@700&display=swap');
        :root { --xmas-red: #A61B1B; --xmas-green: #044A05; --hk-gold: #D4AF37; --bg-cream: #FDFCF0; }
        body { background-color: var(--bg-cream); font-family: 'Noto Sans TC', sans-serif; color: #1F2937; overflow: hidden; height: 100vh; }
        .neon-text { text-shadow: 0 0 5px #fff, 0 0 10px var(--xmas-red); font-family: 'Mountains of Christmas', cursive; }
        .xmas-red { background-color: var(--xmas-red); }
        .xmas-green { background-color: var(--xmas-green); }
        .text-xmas-red { color: var(--xmas-red); }
        .text-xmas-green { color: var(--xmas-green); }
        .text-hk-gold { color: var(--hk-gold); }
        .snowflake { position: absolute; color: white; opacity: 0.5; font-size: 10px; animation: fall linear infinite; pointer-events: none; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .ticket-stub { background: #FFF9E6; border: 3px solid var(--hk-gold); border-style: dashed; position: relative; border-radius: 12px; }
        .timeline-path { position: absolute; left: 58px; top: 0; bottom: 0; width: 2px; background: repeating-linear-gradient(to bottom, #D4AF37 0, #D4AF37 5px, transparent 5px, transparent 10px); z-index: 1; }
    </style>
</head>
<body class="flex flex-col">

<div id="app" class="flex flex-col h-full w-full max-md mx-auto relative bg-[#FDFCF0] shadow-2xl overflow-hidden border-x-4 border-xmas-red">
    
    <div v-for="n in 12" :key="n" class="snowflake" :style="{left: Math.random()*100+'%', animationDuration: (Math.random()*10+5)+'s', animationDelay: Math.random()*5+'s', top: '-20px'}">‚ùÑ</div>

    <header class="xmas-red text-white px-6 pt-10 pb-3 z-30 shadow-lg relative">
        <div class="flex justify-between items-end">
            <h1 class="text-3xl neon-text tracking-widest">Merry HK</h1>
            <div class="text-right">
                <p class="text-[10px] font-black uppercase opacity-70">{{ countdownLabel }}</p>
                <p class="text-xs font-mono font-bold text-hk-gold">{{ countdownText }}</p>
            </div>
        </div>
    </header>

    <nav class="flex xmas-green text-white/50 z-20 shadow-md">
        <button v-for="t in tabs" :key="t.id" @click="currentTab = t.id"
            :class="currentTab === t.id ? 'text-white bg-white/10' : ''"
            class="flex-1 py-4 font-black text-[11px] uppercase transition-all">
            <i :class="t.icon" class="mb-1 block text-sm"></i>{{ t.name }}
        </button>
    </nav>

    <main class="flex-1 overflow-y-auto hide-scrollbar p-4 relative z-10">
        
        <div v-if="currentTab === 'itinerary'">
            <div class="flex mb-5 items-center justify-between">
                <div class="flex space-x-1">
                    <button v-for="d in days" @click="currentDay = d.id" 
                        :class="currentDay === d.id ? 'xmas-red text-white shadow-md' : 'bg-white text-gray-400 border'"
                        class="py-2 px-3 rounded-lg text-[10px] font-black">DAY {{ d.id }}</button>
                </div>
                <div class="flex items-center space-x-2 bg-white px-3 py-1.5 rounded-full border border-hk-gold/30">
                    <i :class="days[currentDay-1].icon" class="text-hk-gold text-sm"></i>
                    <span class="text-xs font-black text-xmas-green">{{ days[currentDay-1].temp }}¬∞C</span>
                </div>
            </div>

            <div v-if="currentDay === 1 || currentDay === 3" class="ticket-stub p-5 mb-8 mx-1">
                <div class="flex justify-between items-center border-b-2 border-dashed border-hk-gold/30 pb-2 mb-4 text-[10px] font-black text-xmas-red italic">
                    <span>FLIGHT TICKET</span>
                    <span class="text-hk-gold">{{ currentDay === 1 ? 'DEPARTURE' : 'RETURN' }}</span>
                </div>
                <div class="flex justify-between items-center px-2">
                    <div class="text-center">
                        <p class="text-4xl font-black text-xmas-red leading-none">{{ currentDay === 1 ? 'KHH' : 'HKG' }}</p>
                        <p class="text-xs font-black text-xmas-green mt-2">{{ currentDay === 1 ? '07:50' : '20:45' }}</p>
                    </div>
                    <div class="flex-1 border-t-2 border-hk-gold/40 border-dotted relative mx-4"><i class="fas fa-sleigh text-hk-gold absolute -top-3 left-1/2 -translate-x-1/2 text-2xl"></i></div>
                    <div class="text-center">
                        <p class="text-4xl font-black text-xmas-red leading-none">{{ currentDay === 1 ? 'HKG' : 'KHH' }}</p>
                        <p class="text-xs font-black text-xmas-green mt-2">{{ currentDay === 1 ? '09:30' : '22:15' }}</p>
                    </div>
                </div>
            </div>

            <div class="relative pl-16">
                <div v-if="currentDayItems.length > 0" class="timeline-path"></div>
                <div v-for="(item, index) in currentDayItems" :key="item.id" class="mb-10 relative">
                    <div class="absolute -left-16 top-1 w-12 text-right text-[11px] font-black text-xmas-green">{{ item.time }}</div>
                    <div class="absolute -left-[11px] top-1.5 w-3 h-3 rounded-full bg-xmas-red z-10 border-2 border-white"></div>
                    
                    <div class="bg-white rounded-xl overflow-hidden shadow-md border-b-4 border-xmas-green p-3">
                        <img v-if="item.image" :src="item.image" class="w-full h-32 object-cover rounded-lg mb-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="font-black text-sm text-xmas-green">{{ item.location }}</h3>
                                <p v-if="item.note" class="text-[10px] text-gray-400 mt-1 italic border-l-2 border-hk-gold pl-2">{{ item.note }}</p>
                            </div>
                            <div class="flex flex-col space-y-2 ml-2 items-end">
                                <div class="flex space-x-1">
                                    <a v-if="item.mapUrl" :href="getMapLink(item.mapUrl)" target="_blank" class="bg-blue-50 text-blue-500 p-2 rounded-lg"><i class="fas fa-map-marked-alt text-xs"></i></a>
                                    <button @click="moveItem(index, -1)" class="bg-gray-50 text-gray-400 p-2 rounded-lg"><i class="fas fa-chevron-up text-[10px]"></i></button>
                                    <button @click="moveItem(index, 1)" class="bg-gray-50 text-gray-400 p-2 rounded-lg"><i class="fas fa-chevron-down text-[10px]"></i></button>
                                    <button @click="deleteItem(index)" class="bg-red-50 text-red-500 p-2 rounded-lg"><i class="fas fa-trash text-[10px]"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="absolute -left-14 bottom-[-28px] z-20">
                        <button @click="editGap(item)" class="bg-white text-[9px] font-black text-xmas-red border border-hk-gold/30 rounded-full px-2 py-1 shadow-sm">
                            <i class="fas fa-clock mr-1"></i>{{ item.gap || 'Ë®≠ÂÆöÈñìÈöî' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'list'" class="space-y-6 pb-10">
            <section class="bg-white p-5 rounded-xl shadow-sm border-l-8 border-xmas-green">
                <h3 class="font-black text-sm text-xmas-green mb-4 italic"> PACKING LIST</h3>
                <div class="flex mb-3">
                    <input v-model="newItemName" @keyup.enter="addItem('packing')" placeholder="Â∏∂‰ªÄÈ∫ºÔºü" class="flex-1 bg-gray-50 px-3 py-2 rounded-l-lg text-xs outline-none border">
                    <button @click="addItem('packing')" class="xmas-green text-white px-4 rounded-r-lg text-xs font-black">ADD</button>
                </div>
                <div v-for="(item, i) in packingList" :key="i" class="flex items-center justify-between mb-2">
                    <div class="flex items-center">
                        <input type="checkbox" v-model="item.done" @change="saveData" class="w-4 h-4 accent-xmas-green">
                        <span class="ml-2 text-xs font-bold" :class="item.done ? 'line-through text-gray-300' : 'text-xmas-green'">{{ item.text }}</span>
                    </div>
                    <button @click="deleteListItem('packing', i)" class="text-gray-200 hover:text-red-500"><i class="fas fa-times text-xs"></i></button>
                </div>
            </section>

            <section class="bg-white p-5 rounded-xl shadow-sm border-l-8 border-hk-gold">
                <h3 class="font-black text-sm text-hk-gold mb-4 italic"> SHOPPING LIST</h3>
                <div class="flex mb-3">
                    <input v-model="newShopName" @keyup.enter="addItem('shopping')" placeholder="Ë≤∑‰ªÄÈ∫ºÔºü" class="flex-1 bg-gray-50 px-3 py-2 rounded-l-lg text-xs outline-none border">
                    <button @click="addItem('shopping')" class="bg-hk-gold text-white px-4 rounded-r-lg text-xs font-black">ADD</button>
                </div>
                <div v-for="(item, i) in shoppingList" :key="i" class="flex items-center justify-between mb-2">
                    <div class="flex items-center">
                        <input type="checkbox" v-model="item.done" @change="saveData" class="w-4 h-4 accent-hk-gold">
                        <span class="ml-2 text-xs font-bold" :class="item.done ? 'line-through text-gray-300' : 'text-gray-700'">{{ item.text }}</span>
                    </div>
                    <button @click="deleteListItem('shopping', i)" class="text-gray-200 hover:text-red-500"><i class="fas fa-times text-xs"></i></button>
                </div>
            </section>
        </div>

        <div v-if="currentTab === 'expense'" class="flex flex-col h-full space-y-4">
            <div class="bg-white p-5 rounded-2xl shadow-lg border-2 border-hk-gold/30 relative text-center">
                <div class="text-[9px] font-black text-hk-gold mb-1 uppercase tracking-widest">1 HKD ‚âà {{ exchangeRate }} TWD</div>
                <p class="text-[10px] font-black text-gray-400 mb-1">TOTAL EXPENSE</p>
                <p class="text-3xl font-black text-xmas-red mb-4">NT$ {{ Math.round(totalExpense * exchangeRate).toLocaleString() }}</p>
                
                <div class="space-y-2">
                    <input v-model="newEx.name" placeholder="È†ÖÁõÆÂêçÁ®± (Â¶ÇÔºöÁîòÁâåÁáíÈµù)" 
                           class="w-full bg-gray-50 border border-gray-200 p-3 rounded-xl text-sm font-bold outline-none focus:border-xmas-red transition-colors">
                    <div class="flex space-x-2">
                        <div class="relative flex-1">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs font-bold">$</span>
                            <input v-model.number="newEx.amount" type="number" placeholder="HKD ÈáëÈ°ç" 
                                   class="w-full bg-gray-50 border border-gray-200 p-3 pl-7 rounded-xl text-sm font-bold outline-none focus:border-xmas-red transition-colors">
                        </div>
                        <button @click="addExpense" class="xmas-red text-white px-6 py-3 rounded-xl text-sm font-black shadow-md active:scale-95 transition-transform">
                            ADD
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto space-y-2 pb-20 hide-scrollbar">
                <div v-for="(ex, i) in expenseList" :key="i" class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex-1 pr-2">
                        <p class="font-black text-sm text-xmas-green truncate">{{ ex.name }}</p>
                        <p class="text-[10px] font-bold text-hk-gold">‚âà NT$ {{ Math.round(ex.amount * exchangeRate) }}</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-black text-xmas-red text-base">${{ ex.amount }}</span>
                        <button @click="deleteExpense(i)" class="text-gray-200 hover:text-red-500 transition-colors">
                            <i class="fas fa-times-circle text-lg"></i>
                        </button>
                    </div>
                </div>
                <div v-if="expenseList.length === 0" class="text-center py-10 opacity-20">
                    <i class="fas fa-receipt text-4xl mb-2"></i>
                    <p class="text-xs font-black">Â∞öÊú™ÊúâË®òÂ∏≥Ë≥áÊñô</p>
                </div>
            </div>

            <div class="mt-auto pt-4 border-t border-dashed border-gray-200 pb-10">
                <div class="grid grid-cols-2 gap-2">
                    <button @click="exportData" class="py-2 bg-white border border-gray-200 text-gray-400 rounded-lg text-[9px] font-black uppercase">Export</button>
                    <button @click="importData" class="py-2 bg-white border border-gray-200 text-gray-400 rounded-lg text-[9px] font-black uppercase">Import</button>
                </div>
            </div>
        </div>    </main>

    <button v-if="currentTab === 'itinerary'" @click="showModal = true" class="absolute bottom-24 right-6 w-14 h-14 xmas-red text-white rounded-full shadow-xl flex items-center justify-center z-50 border-2 border-white/30"><i class="fas fa-plus text-xl"></i></button>

    <div v-if="showModal" class="fixed inset-0 bg-black/70 z-[100] flex items-end justify-center backdrop-blur-sm">
        <div class="bg-[#FDFCF0] rounded-t-[2rem] w-full p-8 max-h-[85vh] overflow-y-auto border-t-8 border-xmas-red">
            <h3 class="font-black text-xl mb-6 text-center text-xmas-red italic uppercase border-b-2 border-hk-gold/30 pb-3">New Plan</h3>
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <input v-model="newItem.time" type="time" class="p-4 bg-white rounded-xl font-bold text-xs border outline-none">
                    <select v-model="newItem.category" class="p-4 bg-white rounded-xl font-bold text-xs border outline-none">
                        <option v-for="c in categories" :value="c">{{c}}</option>
                    </select>
                </div>
                <input v-model="newItem.location" placeholder="Âú∞ÈªûÂêçÁ®±" class="w-full p-4 bg-white rounded-xl font-bold text-xs border outline-none">
                <input v-model="newItem.mapUrl" placeholder="Âú∞ÂùÄ„ÄÅÂ∫óÂêçÊàñ Google Maps ÈÄ£Áµê" class="w-full p-4 bg-white rounded-xl font-bold text-xs border outline-none">
                <textarea v-model="newItem.note" placeholder="ÂÇôË®ª..." class="w-full p-4 bg-white rounded-xl font-bold text-xs h-20 border outline-none"></textarea>
                
                <div class="border-2 border-dashed border-hk-gold/30 rounded-xl p-6 bg-white text-center relative overflow-hidden">
                    <input type="file" @change="handleFileUpload" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer">
                    <div v-if="!newItem.image"><i class="fas fa-camera text-2xl text-hk-gold/40 mb-2"></i><p class="text-[10px] text-gray-400 font-black uppercase">Upload Photo</p></div>
                    <img v-else :src="newItem.image" class="h-32 w-full object-cover rounded-lg">
                </div>
            </div>
            <div class="flex space-x-3 mt-8 pb-4">
                <button @click="showModal = false" class="flex-1 py-4 text-gray-400 font-black text-[11px] uppercase">Cancel</button>
                <button @click="confirmAdd" class="flex-1 py-4 xmas-red text-white font-black rounded-xl text-[11px] uppercase shadow-lg">Add to Day {{ currentDay }}</button>
            </div>
        </div>
    </div>

    <nav class="bg-white border-t border-gray-100 flex justify-around p-3 pb-8 z-50 shadow-2xl">
        <button v-for="t in tabs" @click="currentTab = t.id" :class="currentTab === t.id ? 'text-xmas-red scale-125' : 'text-gray-300'"><i :class="t.icon + ' text-xl'"></i></button>
    </nav>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            currentTab: 'itinerary', currentDay: 1, showModal: false, 
            exchangeRate: 4.12, weatherLoading: true, now: new Date(),
            tabs: [{id:'itinerary', name:'Ë°åÁ®ã', icon:'fas fa-compass'}, {id:'list', name:'Ê∏ÖÂñÆ', icon:'fas fa-gift'}, {id:'expense', name:'Ë®òÂ∏≥', icon:'fas fa-coins'}],
            days: [{id:1, temp:'--', icon:'fas fa-sun'}, {id:2, temp:'--', icon:'fas fa-sun'}, {id:3, temp:'--', icon:'fas fa-sun'}],
            categories: ['üç± ÁæéÈ£ü', 'üéÑ ÊôØÈªû', 'üöå ‰∫§ÈÄö', 'üõçÔ∏è Ë≥ºÁâ©', 'üè® È£ØÂ∫ó'],
            itinerary: [[], [], []], packingList: [], shoppingList: [], expenseList: [],
            newItemName:'', newShopName:'', newEx:{name:'', amount:null},
            newItem: {id:null, time:'12:00', location:'', category:'üç± ÁæéÈ£ü', image:'', note:'', mapUrl:'', gap:''},
            tripStart: new Date('2025-12-25T07:50:00'),
            tripEnd: new Date('2025-12-27T20:45:00')
        }
    },
    computed: {
        currentDayItems() { return this.itinerary[this.currentDay-1] || []; },
        totalExpense() { return this.expenseList.reduce((sum, i)=> sum + (parseFloat(i.amount)||0), 0); },
        countdownLabel() { return this.now < this.tripStart ? 'Departing In' : this.now < this.tripEnd ? 'Trip Ending In' : 'Trip Finished'; },
        countdownText() {
            let target = this.now < this.tripStart ? this.tripStart : this.tripEnd;
            let diff = target - this.now;
            if (diff < 0) return "Merry Christmas!";
            let d = Math.floor(diff / (1000 * 60 * 60 * 24));
            let h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            let m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            let s = Math.floor((diff % (1000 * 60)) / 1000);
            return `${d}D ${h}H ${m}M ${s}S`;
        }
    },
    methods: {
        async fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.2783&longitude=114.1747&daily=weathercode,temperature_2m_max&timezone=Asia%2FHong_Kong');
                const data = await res.json();
                const map = (c) => c <= 3 ? 'fas fa-sun' : c <= 48 ? 'fas fa-cloud' : c <= 67 ? 'fas fa-cloud-rain' : 'fas fa-snowflake';
                for(let i=0; i<3; i++) { this.days[i].temp = Math.round(data.daily.temperature_2m_max[i]); this.days[i].icon = map(data.daily.weathercode[i]); }
            } finally { this.weatherLoading = false; }
        },
        async fetchExchangeRate() {
            try {
                const res = await fetch('https://api.frankfurter.app/latest?from=HKD&to=TWD');
                const data = await res.json();
                if (data.rates.TWD) this.exchangeRate = data.rates.TWD.toFixed(2);
            } catch (e) {}
        },
        getMapLink(input) { return input.startsWith('http') ? input : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(input)}`; },
        addItem(type) {
            if(type==='packing' && this.newItemName) this.packingList.push({text:this.newItemName, done:false});
            if(type==='shopping' && this.newShopName) this.shoppingList.push({text:this.newShopName, done:false});
            this.newItemName = this.newShopName = ''; this.saveData();
        },
        deleteListItem(type, idx) {
            if(type==='packing') this.packingList.splice(idx, 1);
            else this.shoppingList.splice(idx, 1);
            this.saveData();
        },
        handleFileUpload(e) {
            const file = e.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => { this.newItem.image = event.target.result; };
            reader.readAsDataURL(file);
        },
        confirmAdd() {
            this.itinerary[this.currentDay-1].push({...this.newItem, id: Date.now()});
            this.newItem = {id:null, time:'12:00', location:'', category:'üç± ÁæéÈ£ü', image:'', note:'', mapUrl:'', gap:''};
            this.saveData(); this.showModal = false;
        },
        moveItem(idx, dir) {
            const list = this.itinerary[this.currentDay-1];
            const target = idx + dir;
            if (target >= 0 && target < list.length) { [list[idx], list[target]] = [list[target], list[idx]]; this.saveData(); }
        },
        editGap(item) { const val = prompt('Ë®≠ÂÆöÈñìË∑ù (Â¶Ç: Ê≠•Ë°å10ÂàÜÈêò):', item.gap); if (val !== null) { item.gap = val; this.saveData(); } },
        deleteItem(idx) { if(confirm('Á¢∫ÂÆöÂà™Èô§Ôºü')) { this.itinerary[this.currentDay-1].splice(idx, 1); this.saveData(); } },
        addExpense() { if (this.newEx.name && this.newEx.amount) { this.expenseList.push({...this.newEx}); this.newEx={name:'', amount:null}; this.saveData(); } },
        deleteExpense(i) { this.expenseList.splice(i, 1); this.saveData(); },
        exportData() {
            const data = localStorage.getItem('hk_xmas_ultimate_v7');
            prompt('Ë´ãË§áË£Ω‰ª•‰∏ã‰ª£Á¢ºÂÇ≥ÈÄÅÂà∞ÊâãÊ©üÔºö', data);
        },
        importData() {
            const code = prompt('Ë´ãË≤º‰∏äÂÇôÂÇô‰ªΩ‰ª£Á¢ºÔºö');
            if(code) { localStorage.setItem('hk_xmas_ultimate_v7', code); location.reload(); }
        },
        saveData() { localStorage.setItem('hk_xmas_ultimate_v7', JSON.stringify({itinerary:this.itinerary, packingList:this.packingList, shoppingList:this.shoppingList, expenseList:this.expenseList})); },
        loadData() { const d = JSON.parse(localStorage.getItem('hk_xmas_ultimate_v7')); if(d) Object.assign(this, d); }
    },
    mounted() { 
        this.loadData(); this.fetchWeather(); this.fetchExchangeRate();
        setInterval(() => { this.now = new Date(); }, 1000);
    }
}).mount('#app');
</script>
</body>
</html>